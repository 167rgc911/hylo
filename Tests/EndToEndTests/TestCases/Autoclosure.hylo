//- compileAndRun expecting: success

let counter: Int = 0

fun prime() -> Int {
  &counter += 1
  return 17
}

fun logic(withDelayed value: @autoclosure []() -> Int) {
  precondition(counter == 0)
  let x = value()
  precondition(counter == 1)
  precondition(x == 17)
}

fun logic2<E>(withDelayed value: @autoclosure [E]() -> Int) {
  precondition(counter == 0)
  let x = value()
  precondition(counter == 1)
  precondition(x == 17)
}

public fun main() {
  // TODO
  // logic(withDelayed: prime())

  &counter = 0
  // logic2(withDelayed: prime())
  logic2(withDelayed: fun(){ prime() })
}
